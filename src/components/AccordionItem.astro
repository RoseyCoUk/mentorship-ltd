---
// src/components/AccordionItem.astro

interface Props {
  question: string;
  class?: string;
}

const { question, class: className } = Astro.props;
---

<div class:list={["accordion-item accordion-line", className]}>
  <button
    class="accordion-trigger group flex w-full items-center justify-between py-6 sm:py-8 text-left transition-all duration-300"
    type="button"
    aria-expanded="false"
  >
    <span class="font-heading text-h3 text-text-primary group-hover:text-gold transition-colors duration-300">{question}</span>
    <div class="relative h-6 w-6 shrink-0 flex items-center justify-center">
      <!-- Horizontal line -->
      <div class="absolute w-full h-[1.5px] bg-white transition-all duration-500 group-hover:bg-gold"></div>
      <!-- Vertical line (rotates to horizontal on open) -->
      <div class="accordion-icon-v absolute w-[1.5px] h-full bg-white transition-all duration-500 group-hover:bg-gold"></div>
    </div>
  </button>
  <div class="accordion-content overflow-hidden max-h-0 transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)]">
    <div class="pb-5 text-text-secondary">
      <slot />
    </div>
  </div>
</div>

<script>
  function setupAccordions() {
    const triggers = document.querySelectorAll('.accordion-trigger');
    triggers.forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const item = trigger.closest('.accordion-item');
        const content = item?.querySelector('.accordion-content') as HTMLElement;
        const iconV = item?.querySelector('.accordion-icon-v');
        const isOpen = trigger.getAttribute('aria-expanded') === 'true';

        if (!isOpen) {
          trigger.setAttribute('aria-expanded', 'true');
          content.style.maxHeight = content.scrollHeight + 'px';
          iconV?.classList.add('rotate-90', 'scale-0');
        } else {
          trigger.setAttribute('aria-expanded', 'false');
          content.style.maxHeight = '0px';
          iconV?.classList.remove('rotate-90', 'scale-0');
        }
      });
    });
  }

  setupAccordions();
  document.addEventListener('astro:after-swap', setupAccordions);
</script>
